
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://fxphpfvfcogalwtbishv.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4cGhwZnZmY29nYWx3dGJpc2h2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU0NTQyNDksImV4cCI6MjA2MTAzMDI0OX0.9sxvHMcbdX8n0VY_3sNF9qL7i5EN8FAMOHWy738reh0";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(
  SUPABASE_URL, 
  SUPABASE_PUBLISHABLE_KEY,
  {
    auth: {
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: true,
      storageKey: 'supabase-horeca-app-auth'
    },
    realtime: {
      params: {
        eventsPerSecond: 10
      }
    }
  }
);

// Enable realtime for database tables
const enableRealtimeTables = async () => {
  try {
    // Create and subscribe to a channel for the cafes table with explicit events
    const cafesChannel = supabase.channel('cafes-channel')
      .on('postgres_changes', 
        { 
          event: 'INSERT', 
          schema: 'public', 
          table: 'cafes' 
        }, 
        (payload) => {
          console.log('New cafe inserted:', payload);
        }
      )
      .on('postgres_changes', 
        { 
          event: 'UPDATE', 
          schema: 'public', 
          table: 'cafes' 
        }, 
        (payload) => {
          console.log('Cafe updated:', payload);
        }
      )
      .on('postgres_changes', 
        { 
          event: 'DELETE', 
          schema: 'public', 
          table: 'cafes' 
        }, 
        (payload) => {
          console.log('Cafe deleted:', payload);
        }
      );

    // Create and subscribe to a channel for the cafe_surveys table
    const surveysChannel = supabase.channel('surveys-channel')
      .on('postgres_changes', 
        { 
          event: '*', 
          schema: 'public', 
          table: 'cafe_surveys' 
        }, 
        (payload) => {
          console.log('Cafe survey changed:', payload);
        }
      );
    
    // Create and subscribe to a channel for the brand_sales table
    const brandSalesChannel = supabase.channel('brand-sales-channel')
      .on('postgres_changes', 
        { 
          event: '*', 
          schema: 'public', 
          table: 'brand_sales' 
        }, 
        (payload) => {
          console.log('Brand sales changed:', payload);
        }
      );

    // Subscribe to all channels
    await cafesChannel.subscribe();
    await surveysChannel.subscribe();
    await brandSalesChannel.subscribe();
    
    console.log('Realtime enabled for all database tables');
  } catch (error) {
    console.error('Error enabling realtime:', error);
  }
};

// Call the function when the client is initialized
enableRealtimeTables();
